var napoletana = [
    { "number": "1", "text": "L'Italia", "translation": "" },
    { "number": "2", "text": "'A criatura", "translation": "il bimbo" },
    { "number": "3", "text": "'A jatta", "translation": "il gatto" },
    { "number": "4", "text": "'O puorco", "translation": "il maiale" },
    { "number": "5", "text": "'A mano", "translation": "la mano" },
    { "number": "6", "text": "Chella che guarda 'nterra", "translation": "organo sessuale femminile" },
    { "number": "7", "text": "'A scuppetta", "translation": "il fucile" },
    { "number": "8", "text": "'A maronna", "translation": "la madonna" },
    { "number": "9", "text": "'A figliata", "translation": "la prole" },
    { "number": "10", "text": "'E fasule", "translation": "i fagioli" },
    { "number": "11", "text": "'E surice", "translation": "i topi" },
    { "number": "12", "text": "'E surdate", "translation": "i soldati" },
    { "number": "13", "text": "Sant'Antonio", "translation": "" },
    { "number": "14", "text": "'O mbriaco", "translation": "l'ubriaco" },
    { "number": "15", "text": "'O guaglione", "translation": "il ragazzo" },
    { "number": "16", "text": "'O culo", "translation": "il deretano" },
    { "number": "17", "text": "'A disgrazia", "translation": "la disgrazia" },
    { "number": "18", "text": "'O sanghe", "translation": " il sangue" },
    { "number": "19", "text": "'A resata", "translation": "la risata" },
    { "number": "20", "text": "'A festa", "translation": "la festa" },
    { "number": "21", "text": "'A femmena annura", "translation": "la donna nuda" },
    { "number": "22", "text": "'O pazzo", "translation": "il pazzo" },
    { "number": "23", "text": "'O scemo", "translation": "lo scemo" },
    { "number": "24", "text": "'E gguardie", "translation": "le guardie" },
    { "number": "25", "text": "Natale", "translation": "" },
    { "number": "26", "text": "Nanninella", "translation": "diminuitivo del nome Anna" },
    { "number": "27", "text": "'O cantero", "translation": "il vaso da notte" },
    { "number": "28", "text": "'E zzizze", "translation": "il seno" },
    { "number": "29", "text": "'O pate d''e criature", "translation": "organo sessuale maschile" },
    { "number": "30", "text": "'E palle d''o tenente", "translation": "le palle del tenente" },
    { "number": "31", "text": "'O padrone ' e casa", "translation": "il proprietario di casa" },
    { "number": "32", "text": "'O capitone", "translation": "il capitone" },
    { "number": "33", "text": "Ll'anne ' e Cristo", "translation": "gli anni di Cristo" },
    { "number": "34", "text": "'A capa", "translation": "la testa" },
    { "number": "35", "text": "L'aucielluzzo", "translation": "l'uccellino" },
    { "number": "36", "text": "'E castagnelle", "translation": "sorta di petardi" },
    { "number": "37", "text": "'O monaco", "translation": "il frate" },
    { "number": "38", "text": "'E mmazzate", "translation": "le botte" },
    { "number": "39", "text": "'A funa 'nganna", "translation": "la corda la collo" },
    { "number": "40", "text": "'A paposcia", "translation": "ernia inguinale" },
    { "number": "41", "text": "'O curtiello", "translation": "il coltello" },
    { "number": "42", "text": "'O ccafè", "translation": "il caffè" },
    { "number": "43", "text": "'A femmena 'ncopp'' o balcone", "translation": "la donna al balcone" },
    { "number": "44", "text": "'E ccancelle", "translation": "il carcere" },
    { "number": "45", "text": "'O vino", "translation": "il vino" },
    { "number": "46", "text": "'E denare", "translation": "i denari" },
    { "number": "47", "text": "'O muorto", "translation": "il morto" },
    { "number": "48", "text": "'O muorto che parla", "translation": "il morto che parla" },
    { "number": "49", "text": "'O piezzo ' e carne", "translation": "il pezzo di carne" },
    { "number": "50", "text": "'O ppane", "translation": "il pane" },
    { "number": "51", "text": "'O ciardino", "translation": "il giardino" },
    { "number": "52", "text": "'A mamma", "translation": "la mamma" },
    { "number": "53", "text": "'O viecchio", "translation": "il vecchio" },
    { "number": "54", "text": "'O cappiello", "translation": "il cappello" },
    { "number": "55", "text": "'A museca", "translation": "la musica" },
    { "number": "56", "text": "'A caruta", "translation": "la caduta" },
    { "number": "57", "text": "'O scartellato", "translation": "il gobbo" },
    { "number": "58", "text": "'O paccotto", "translation": "l'imbroglio" },
    { "number": "59", "text": "'E pile", "translation": "i peli" },
    { "number": "60", "text": "Se lamenta", "translation": "si lamenta" },
    { "number": "61", "text": "'O cacciatore", "translation": "il cacciatore" },
    { "number": "62", "text": "'O muorto acciso", "translation": "il morto ammazzato" },
    { "number": "63", "text": "'A sposa", "translation": "la sposa" },
    { "number": "64", "text": "'A sciammeria", "translation": "la marsina" },
    { "number": "65", "text": "'O chianto", "translation": "il pianto" },
    { "number": "66", "text": "'E ddoie zetelle", "translation": "le due zitelle" },
    { "number": "67", "text": "'O totano int''a chitarra", "translation": "il totano nella chitarra" },
    { "number": "68", "text": "'A zuppa cotta", "translation": "la zuppa cotta" },
    { "number": "69", "text": "Sott'e'ncoppo", "translation": "sottosopra" },
    { "number": "70", "text": "'O palazzo", "translation": "il palazzo" },
    { "number": "71", "text": "L'ommo 'e merda", "translation": "l'uomo senza princìpi" },
    { "number": "72", "text": "'A meraviglia", "translation": "la meraviglia" },
    { "number": "73", "text": "'O spitale", "translation": "l'ospedale" },
    { "number": "74", "text": "'A rotta", "translation": "la grotta" },
    { "number": "75", "text": "Pullecenella", "translation": "Pulcinella" },
    { "number": "76", "text": "'A funtana", "translation": "la fontana" },
    { "number": "77", "text": "'E diavule", "translation": "i diavoli" },
    { "number": "78", "text": "'A bella figliola", "translation": "la bella ragazza" },
    { "number": "79", "text": "'O mariuolo", "translation": "il ladro" },
    { "number": "80", "text": "'A vocca", "translation": "la bocca" },
    { "number": "81", "text": "'E sciure", "translation": "i fiori" },
    { "number": "82", "text": "'A tavula 'mbandita", "translation": "la tavola imbandita" },
    { "number": "83", "text": "'O maletiempo", "translation": "il maltempo" },
    { "number": "84", "text": "'A cchiesa", "translation": "la chiesa" },
    { "number": "85", "text": "Ll'aneme 'o priatorio", "translation": "le anime del purgatorio" },
    { "number": "86", "text": "'A puteca", "translation": "il negozio" },
    { "number": "87", "text": "'E perucchie", "translation": "i pidocchi" },
    { "number": "88", "text": "'E casecavalle", "translation": "i caciocavalli" },
    { "number": "89", "text": "'A vecchia", "translation": "la vecchia" },
    { "number": "90", "text": "'A paura", "translation": "la paura" }
];

const dbRef = firebase.database().ref();

var foo = [];

var tabellone = $('#tabellaInner');

function generateNumbers() {
    tabellone.empty();
    for (var i = 0; i < 180; i++) {
        if (i < 90) {
            tabellone.append($('<div class="cell"><span class="circle" id="id' + i + '">' + (i + 1) + '</span></div>'));
        }
        foo.push((i + 1) > 90 ? (i - 89) : (i + 1));
    }
}

generateNumbers();

var ID = function () {
    return Math.random().toString(36).substr(2, 3).toUpperCase()+"-"+Math.random().toString(36).substr(2, 3).toUpperCase()+"-"+Math.random().toString(36).substr(2, 3).toUpperCase();
};

var gameID = ID();

$("#gameID").text(gameID);

var game_settings = dbRef.child("/games").child(gameID);
game_settings.on('value', function(snapshot) {
    if (snapshot.exists() !== true) {
        game_settings.set({
            "gameID": gameID,
            "last_number": $("#number").text(),
        });
    } else {
        game_settings.update({
            "gameID": gameID,
            "last_number": $("#number").text(),
        });
    }
});

function getUnique(array){
    var uniqueArray = [];
    
    // Loop through array values
    for(i=0; i < array.length; i++){
        if(uniqueArray.indexOf(array[i]) === -1) {
            uniqueArray.push(array[i]);
        }
    }
    return uniqueArray;
}

var game_player = dbRef.child("/games").child(gameID).child("players");
game_player.on('value', function(snapshot) {
    if(snapshot.exists()) {
        $("#player-list").empty();
        $.each(snapshot.val(), function(key, val) {
            $(".player-join").removeClass("reverse").fadeIn("fast");
            $("#player-list").append("<p>"+val+"</p>");
            $(".player-join").html('<strong>'+val+'</strong> è entrato in partita.');
            setTimeout(function() {
                $(".player-join").addClass("reverse");
            }, 2000);
            setTimeout(function() {
                $(".player-join").fadeOut("fast");
            }, 3000);
        });
    } else {
        game_player.set({
            "0": "Tabellone"
        })
        console.log("No data available");
    }
});

$('#extract').click(function () {
    if (foo.length == 0) {
        $(this).text('Estrai numero');
        $('#number').text('');
        $('#didascalia').text('');
        $('#traduzione').text('');
        generateNumbers();
    } else {
        var randomIndex = Math.floor((Math.random() * foo.length));

        $('#number').text(foo[randomIndex]);
        napoletanaIndex = foo[randomIndex] - 1;

        $('#id' + napoletanaIndex).addClass('selected');
        $('#didascalia').text(napoletana[napoletanaIndex].text);
        $('#traduzione').text(napoletana[napoletanaIndex].translation);

        foo = foo.filter(function (value) {
            return value != foo[randomIndex];
        });

        if (foo.length == 0) {
            $(this).text('Clicca per resettare');
        }

        // ANIMATION: RESTART BOLLO
        $('.sidebarTop').removeClass('action');
        setTimeout(function () {
            $('.sidebarTop').addClass('action');
        }, 1000);

        $('#disableExtract').addClass('active');
        setTimeout(function () {
            $('#disableExtract').removeClass("active");
        }, 4500);
    }
    var game_settings = dbRef.child("/games").child(gameID);
    game_settings.on('value', function(snapshot) {
        if (snapshot.exists() !== true) {
            game_settings.set({
                "gameID": gameID,
                "last_number": $("#number").text()
            });
        } else {
            game_settings.update({
                "gameID": gameID,
                "last_number": $("#number").text()
            });
        }
    });
});

// GESTIONE OVERLAY
$('.iconClose').click(function () {
    $('.chiudiPagina').toggleClass('view');
    $('.chiudiPagina .overlayInner').toggleClass('view');
});
$('.chiudiPagina').click(function () {
    $(this).toggleClass('view');
    $('.chiudiPagina .overlayInner').toggleClass('view');
});

$('.openAiuto').click(function () {
    $('.aiutoPagina').toggleClass('view');
    $('.aiutoPagina .overlayInner').toggleClass('view');
});
$('.aiutoPagina').click(function () {
    $(this).toggleClass('view');
    $('.aiutoPagina .overlayInner').toggleClass('view');
});

// SWITCH: FUNCTION
$('.button').click(function () {
    $('.spiegaTabellone').addClass('off');
});


window.onbeforeunload = function(){
    e.preventDefault();
    game_settings.remove();
}

window.addEventListener("beforeunload", function(e){
    e.preventDefault();
    game_settings.remove();

}, false);